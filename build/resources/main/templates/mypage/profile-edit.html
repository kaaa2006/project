<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}" lang="ko">
<head>
    <meta charset="UTF-8">
    <title>회원정보 수정</title>

    <th:block layout:fragment="page_head">
        <link rel="stylesheet" th:href="@{/css/pages/mypage.css}">
        <link rel="stylesheet" th:href="@{/css/pages/mypage-profile.css}">
    </th:block>

    <th:block layout:fragment="page_foot">
        <script th:src="@{/js/mypage-profile-edit.js}" defer></script>
    </th:block>
</head>
<body>
<div layout:fragment="content" class="mypage-wrap d-flex gap-4">

    <!-- 좌측 세로 카테고리바 (동일) -->
    <aside th:replace="~{fragments/mypage-side :: side('profile')}"></aside>

    <!-- 오른쪽 콘텐츠 -->
    <main class="content flex-grow-1">

        <!-- 상단 헤더: profile 페이지와 동일 톤 -->
        <div class="page-header pf-border-accent">
            <div class="eyebrow">My Page</div>
            <h2 class="page-title">회원정보 수정</h2>
            <div class="page-sub">휴대폰, 마케팅 수신동의, (선택) 비밀번호 변경만 가능합니다.</div>
        </div>

        <!-- 수정 폼 시작 -->
        <form id="profileEditForm"
              th:action="@{/mypage/profile/edit}"
              method="post"
              th:object="${form}"
              novalidate
              class="pf-form">
            <!-- ✅ 네이티브 POST용 CSRF 필수 -->
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}">

        <!-- 연락처/마케팅 카드: profile의 card-elevated + table-profile 사용 -->
            <section class="card-elevated">
                <div class="card-title">
                    <i class="bi bi-person-check"></i>
                    <span>연락처 & 마케팅 수신동의</span>
                </div>

                <div class="table-responsive">
                    <table class="table table-sm align-middle table-profile">
                        <tbody>
                        <tr>
                            <th>휴대폰</th>
                            <td>
                                <input type="text"
                                       class="pf-input form-control"
                                       th:field="*{phone}"
                                       placeholder="010-1234-5678"
                                       maxlength="20"
                                       inputmode="numeric">
                                <div class="pf-help">숫자사이에 하이픈(-)제외 입력 (예: 01012345678)</div>
                                <div class="pf-error" th:if="${#fields.hasErrors('phone')}" th:errors="*{phone}"></div>
                            </td>
                        </tr>
                        <tr>
                            <th>마케팅 수신</th>
                            <td>
                                <div class="form-check">
                                    <input type="checkbox" class="form-check-input" th:field="*{marketingYn}" id="mkYn">
                                    <label class="form-check-label" for="mkYn">홍보/이벤트 정보 수신에 동의합니다.</label>
                                </div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- 비밀번호 변경 카드: 같은 카드/테이블 톤 -->
            <section class="card-elevated">
                <div class="card-title">
                    <i class="bi bi-shield-lock"></i>
                    <span>비밀번호 변경 (선택)</span>
                </div>

                <div class="table-responsive">
                    <table class="table table-sm align-middle table-profile">
                        <tbody>
                        <tr>
                            <th>현재 비밀번호</th>
                            <td>
                                <input type="password"
                                       class="pf-input form-control"
                                       th:field="*{currentPassword}"
                                       autocomplete="current-password"
                                       placeholder="현재 비밀번호">
                            </td>
                        </tr>
                        <tr>
                            <th>새 비밀번호</th>
                            <td>
                                <input type="password"
                                       class="pf-input form-control"
                                       th:field="*{newPassword}"
                                       autocomplete="new-password"
                                       placeholder="새 비밀번호 (8~64자)">
                            </td>
                        </tr>
                        <tr>
                            <th>새 비밀번호 확인</th>
                            <td>
                                <input type="password"
                                       class="pf-input form-control"
                                       th:field="*{newPasswordConfirm}"
                                       autocomplete="new-password"
                                       placeholder="새 비밀번호 확인">
                                <!-- DTO @AssertTrue 전역 오류 메시지 표시 -->
                                <div class="pf-error" th:if="${#fields.hasErrors('passwordBlockValid')}"
                                     th:errors="*{passwordBlockValid}"></div>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </div>

                <div class="pf-help">※ 위 3칸을 모두 입력한 경우에만 비밀번호가 변경됩니다. 입력하지 않으면 변경되지 않습니다.</div>
            </section>

            <!-- 하단 액션: profile 스타일(.actions + pf-btn) 그대로 -->
            <div class="actions">
                <a class="pf-btn pf-btn-outline" th:href="@{/mypage/profile}">취소</a>
                <button type="submit" class="pf-btn pf-btn-primary">저장하기</button>
            </div>
        </form>
        <!-- 수정 폼 끝 -->

    </main>
</div>
</body>
</html>
