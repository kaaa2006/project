<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layouts/layout1}">

<head>
  <title>주문 완료</title>
  <th:block layout:fragment="page_head">
    <link rel="stylesheet" th:href="@{/css/pages/order-complete.css}">
  </th:block>
</head>

<body>
<main layout:fragment="content" class="container order-complete-page">

  <!-- ✅ 주문 완료 메시지 -->
  <section class="complete-header text-center my-5">
    <h2>주문이 완료되었습니다 🎉</h2>
    <p>주문해 주셔서 감사합니다. 아래는 주문 내역입니다.</p>
  </section>

  <!-- ✅ 격자 배치 -->
  <div class="row">
    <!-- 주문 정보 -->
    <div class="col-md-6 mb-4">
      <div class="card shadow-sm p-3">
        <h4>주문 정보</h4>
        <ul>
          <li><strong>주문번호:</strong> <span th:text="${order.orderNo}"></span></li>
          <li><strong>주문일자:</strong>
            <span th:text="${#temporals.format(order.orderedAt, 'yyyy-MM-dd HH:mm')}"></span>
          </li>
          <li><strong>결제금액:</strong>
            <span th:text="${#numbers.formatInteger(order.payableAmount, 3, 'COMMA')} + '원'"></span>
          </li>
          <li><strong>결제수단:</strong> <span th:text="${order.payMethod}"></span></li>
          <li><strong>주문상태:</strong> <span th:text="${order.status.getDescription()}"></span></li>
        </ul>
      </div>
    </div>

    <!-- 주문자 정보 -->
    <div class="col-md-6 mb-4">
      <div class="card shadow-sm p-3">
        <h4>주문자 정보</h4>
        <ul>
          <li><strong>회원번호:</strong> <span th:text="${memberNum}"></span></li>
          <li><strong>이름:</strong> <span th:text="${memberName}"></span></li>
          <li><strong>전화번호:</strong> <span th:text="${memberPhone}"></span></li>
          <li><strong>잔여 포인트:</strong>
            <span th:text="${#numbers.formatInteger(memberPoints, 3, 'COMMA')} + 'P'"></span>
          </li>
        </ul>
      </div>
    </div>
  </div>

  <!-- 배송지 -->
  <div class="row mb-4">
    <div class="col-12">
      <div class="card shadow-sm p-3">
        <h4>배송지</h4>
        <p th:text="${order.zipcode + ' ' + order.addr1 + ' ' + (order.addr2 != null ? order.addr2 : '')}"></p>
      </div>
    </div>
  </div>

  <!-- 주문 상품 -->
  <div class="row">
    <div class="col-12">
      <div class="card shadow-sm p-3">
        <h4>주문 상품</h4>
        <table class="table table-striped">
          <thead>
          <tr>
            <th>상품명</th>
            <th>수량</th>
            <th>단가</th>
            <th>합계</th>
          </tr>
          </thead>
          <tbody>
          <!-- ✅ DTO lines 사용 -->
          <tr th:each="line : ${order.lines}">
            <td th:text="${line.itemName}">상품명</td>
            <td th:text="${line.quantity}">1</td>
            <td th:text="${#numbers.formatInteger(line.salePrice, 3, 'COMMA')} + '원'">10,000원</td>
            <td th:text="${#numbers.formatInteger(line.lineTotal, 3, 'COMMA')} + '원'">20,000원</td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- ✅ 결제 요약 -->
  <div class="row mt-3">
    <div class="col-12">
      <div class="card shadow-sm p-3">
        <h4>결제 요약</h4>
        <table class="table">
          <tbody>
          <tr>
            <th style="width:160px;">총 상품금액</th>
            <td th:text="${#numbers.formatInteger(order.productsTotal,3,'COMMA')} + '원'">0원</td>
          </tr>
          <tr th:if="${order.discountTotal > 0}">
            <th>등급 할인</th>
            <td class="text-danger"
                th:text="'-' + ${#numbers.formatInteger(order.discountTotal,3,'COMMA')} + '원'">-0원</td>
          </tr>
          <tr>
            <th>배송비</th>
            <td th:text="${order.shippingFee == 0 ? '무료' : #numbers.formatInteger(order.shippingFee,3,'COMMA') + '원'}">0원</td>
          </tr>
          <tr class="fw-bold">
            <th>결제금액</th>
            <td th:text="${#numbers.formatInteger(order.payableAmount,3,'COMMA')} + '원'">0원</td>
          </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>

  <!-- 버튼 -->
  <section class="order-actions text-center mt-5">
    <a th:href="@{/thymeleaf/main}" class="btn btn-lg btn-outline-secondary me-2">메인으로</a>
    <a th:href="@{/orders/list}" class="btn btn-lg btn-primary">주문내역 보기</a>
  </section>

</main>
</body>
</html>
