<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>팁 수정</title>

    <!-- ✅ 페이지 전용 CSS -->
    <link rel="stylesheet" th:href="@{/css/pages/tipBoardEdit.css?v=1}">

    <!-- ── 전역 CSS ──────────────────────────────── -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/tokens.css?v=2}">
    <link rel="stylesheet" th:href="@{/css/components.css?v=2}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9.4.1/swiper-bundle.min.css">
    <link rel="stylesheet" th:href="@{/css/header.css?v=20250821}">
    <link rel="icon" th:href="@{/favicon.ico}">

    <!-- CSRF for AJAX -->
    <meta name="_csrf" th:content="${_csrf.token}">
    <meta name="_csrf_header" th:content="${_csrf.headerName}">
</head>
<body class="tip-edit">

<!-- 공통 헤더 -->
<header th:replace="~{fragments/header :: header}"></header>

<main class="detail-container">
    <h1 class="page-title">TIP 수정</h1>

    <form th:action="@{/board/tip/modify}" th:object="${dto}" method="post"
          class="tip-form" onsubmit="return validateTipForm();">

        <!-- CSRF 토큰 -->
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

        <!-- bno 히든 필드 -->
        <input type="hidden" th:field="*{bno}" />

        <!-- 제목 -->
        <div class="field-row">
            <label for="title">제목</label>
            <input type="text" th:field="*{title}" id="title" placeholder="제목을 입력하세요" required>
        </div>

        <!-- 작성자 -->
        <div class="field-row">
            <label for="writer">작성자</label>
            <input type="text" th:field="*{writer}" id="writer" readonly>
        </div>

        <!-- 이미지 업로드 -->
        <div class="field-row">
            <label for="image">이미지 업로드</label>
            <input type="file" id="image" name="image" accept="image/*">
            <div class="image-preview-wrap">
                <img id="image-preview" alt="미리보기">
            </div>
            <div class="help">※ 이미지를 선택하면 아래에 미리보기가 표시됩니다.</div>
        </div>

        <!-- 내용 -->
        <div class="field-row">
            <label for="content">내용</label>
            <textarea th:field="*{content}" id="content" rows="10"
                      placeholder="내용을 입력하세요" required></textarea>
        </div>

        <!-- 버튼 -->
        <div class="form-buttons">
            <button type="submit" class="btn-submit">
                <i class="bi bi-check2-circle"></i> 수정 저장
            </button>
            <a th:href="@{/board/tip/list}" class="btn-cancel">
                <i class="bi bi-arrow-left"></i> 취소
            </a>
        </div>
    </form>
</main>

<!-- 공통 푸터 -->
<footer th:replace="~{fragments/footer :: footer}"></footer>

<!-- 페이지 스크립트: 기존 기능 유지 + 폼 확인/이미지 미리보기만 추가 -->
<script th:src="@{/js/tipBoard.js}"></script>
<script>
    // 제출 전 간단 검증 + 확인 팝업 (기능 변경 없음)
    function validateTipForm(){
        const title = document.getElementById('title')?.value.trim();
        const content = document.getElementById('content')?.value.trim();
        if(!title){ alert('제목을 입력하세요.'); document.getElementById('title').focus(); return false; }
        if(!content){ alert('내용을 입력하세요.'); document.getElementById('content').focus(); return false; }
        return confirm('게시글을 수정하시겠습니까?'); // 확인/취소
    }

    // 이미지 미리보기
    (function(){
        const input = document.getElementById('image');
        const preview = document.getElementById('image-preview');
        if(!input || !preview) return;

        // 초기 숨김
        preview.style.display = 'none';
        preview.removeAttribute('src');

        input.addEventListener('change', function(){
            const file = this.files && this.files[0];
            if(!file){ preview.removeAttribute('src'); preview.style.display='none'; return; }
            const reader = new FileReader();
            reader.onload = (e) => {
                preview.src = e.target.result;
                preview.style.display = 'block';
            };
            reader.readAsDataURL(file);
        });

        // 깨진 이미지 방지
        preview.onerror = function(){
            this.style.display='none';
            this.removeAttribute('src');
        };
    })();
</script>

<!-- ── 전역 JS ──────────────────────────────── -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/swiper@9.4.1/swiper-bundle.min.js"></script>
<script th:src="@{/js/main.js}" defer></script>
</body>
</html>
