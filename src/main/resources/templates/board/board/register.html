<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>게시글 작성</title>

    <!-- 전역 CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css">
    <link rel="stylesheet" th:href="@{/css/tokens.css?v=2}">
    <link rel="stylesheet" th:href="@{/css/components.css?v=2}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9.4.1/swiper-bundle.min.css">
    <link rel="stylesheet" th:href="@{/css/header.css?v=20250821}">
    <link rel="stylesheet" th:href="@{/css/footer.css?v=20250821}">

    <!-- ⬇ 페이지 전용 CSS는 마지막 -->
    <link rel="stylesheet" th:href="@{/css/pages/board.css?v=fix1}">


    <link rel="icon" th:href="@{/favicon.ico}">

    <!-- CSRF for AJAX -->
    <meta name="_csrf" th:content="${_csrf.token}">
    <meta name="_csrf_header" th:content="${_csrf.headerName}">
</head>
<body>

<!-- 공통 헤더 -->
<header th:replace="~{fragments/header :: header}"></header>

<main class="container py-4 board-write">
    <h1 class="bw-page-title">글 작성</h1>

    <!-- 카드 래퍼 -->
    <section class="bw-card">
        <form id="registerForm"
              th:action="@{/board/register}"
              method="post"
              enctype="multipart/form-data"
              th:object="${boardDTO}"
              novalidate>

            <!-- CSRF -->
            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />

            <!-- ===== 폼 그리드 ===== -->
            <div class="bw-grid">

                <!-- 게시판 선택 -->
                <div class="bw-row bw-span-2">
                    <label for="boardTypeSelect">게시판:</label>
                    <div class="bw-select">
                        <select id="boardTypeSelect" name="boardType" th:field="*{boardType}">
                            <option th:each="bt : ${boardTypes}"
                                    th:value="${bt.name()}"
                                    th:text="${bt.label}"
                                    th:selected="${bt} == ${boardDTO.boardType}">
                            </option>
                        </select>
                    </div>
                </div>

                <!-- 제목 -->
                <div class="bw-span-2">
                    <label for="titleInput">제목:</label>
                    <input type="text" th:field="*{title}" id="titleInput" required>
                </div>

                <!-- 내용 -->
                <div class="bw-span-2">
                    <label for="contentInput">내용:</label>
                    <textarea th:field="*{content}" id="contentInput" required></textarea>
                </div>

                <!-- 첨부파일(초기 숨김) -->
                <div id="fileUploadDiv" class="bw-row bw-span-2" style="display:none;">
                    <label for="files">첨부파일:</label>
                    <input id="files" type="file" th:field="*{files}" multiple>
                </div>

                <!-- 이벤트 전용 기간(초기 숨김) -->
                <div id="dateDiv" class="bw-row bw-span-2" style="display:none;">
                    <label for="startDate">이벤트 기간:</label>
                    <div class="d-flex gap-2 flex-wrap">
                        <input type="date" th:field="*{startDate}" id="startDate" required>
                        <span class="align-self-center">~</span>
                        <input type="date" th:field="*{endDate}" id="endDate" required>
                    </div>
                </div>

                <!-- 액션: 목록(좌) / 등록(우) -->
                <div class="bw-actions bw-span-2">
                    <a class="pf-btn pf-btn-outline"
                       th:href="@{/board/list(boardType=${boardDTO.boardType != null ? boardDTO.boardType.name() : 'NOTICE'})}">
                        목록
                    </a>
                    <button type="submit" class="pf-btn pf-btn-primary">등록</button>
                </div>
            </div>
            <!-- ===== /폼 그리드 ===== -->

        </form>
    </section>
</main>

<!-- 공통 푸터 -->
<footer th:replace="~{fragments/footer :: footer}"></footer>

<!-- JS: 카테고리 변경 시 placeholder/표시영역 토글 (안전 최소 스크립트) -->
<script>
    (function(){
        const sel  = document.getElementById('boardTypeSelect');
        const titleEl  = document.getElementById('titleInput');
        const contentEl= document.getElementById('contentInput');
        const fileBox  = document.getElementById('fileUploadDiv');
        const dateBox  = document.getElementById('dateDiv');

        function apply(type){
            const t = String(type || '').toUpperCase();
            // 공통: 버튼/바 색은 CSS에서 고정 (#00DCA0)
            if (t === 'FAQ') {
                titleEl?.setAttribute('placeholder',  '질문 제목을 입력하세요');
                contentEl?.setAttribute('placeholder','질문 내용을 입력하세요');
                if (fileBox) fileBox.style.display = 'none';
                if (dateBox) dateBox.style.display = 'none';
            } else if (t === 'NOTICE') {
                titleEl?.setAttribute('placeholder',  '공지 제목을 입력하세요');
                contentEl?.setAttribute('placeholder','공지 내용을 입력하세요');
                if (fileBox) fileBox.style.display = 'block';
                if (dateBox) dateBox.style.display = 'none';
            } else { // EVENT
                titleEl?.setAttribute('placeholder',  '이벤트 제목을 입력하세요');
                contentEl?.setAttribute('placeholder','이벤트 상세 내용을 입력하세요');
                if (fileBox) fileBox.style.display = 'block';
                if (dateBox) dateBox.style.display = 'block';
            }
        }

        // 초기
        apply(sel?.value);
        // 변경
        sel?.addEventListener('change', () => apply(sel.value));
    })();
</script>

<!-- 기존 로직 -->
<!-- 기존 로직 -->
<script th:src="@{/js/board.js}"></script>

<!-- 등록 전 확인 알럿 (확인/취소) -->
<script>
    (function () {
        const form = document.getElementById('registerForm');
        if (!form) return;

        form.addEventListener('submit', function (e) {
            // 이미 확인 후 진행 중이면 그대로 통과
            if (form.dataset.submitting === 'true') return;

            e.preventDefault(); // 기본 제출 잠시 막기
            const ok = window.confirm('게시글을 등록하시겠습니까?'); // 확인/취소

            if (ok) {
                form.dataset.submitting = 'true'; // 재진입 방지
                form.submit(); // 네이티브 제출(이벤트 재발생 없음)
            }
            // 취소면 아무 것도 하지 않음
        });
    })();
</script>

</body>
</html>
